<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocuMind - Code Documentation Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† DocuMind</h1>
            <p class="subtitle">Python Code Documentation & Structure Analyzer</p>
        </header>

        <div class="main-content">
            <div class="input-section">
                <!-- Parser Mode Selection -->
                <div class="parser-mode-selection" style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, #334155 0%, #1e293b 100%); border-radius: 16px; border: 1px solid rgba(59, 130, 246, 0.2); box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);">
                    <label style="display: block; margin-bottom: 15px; font-weight: 700; color: #60a5fa; font-size: 1rem; text-transform: uppercase; letter-spacing: 1.2px;">Parser Mode:</label>
                    <div style="display: flex; gap: 30px;">
                        <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 15px; border-radius: 8px; transition: all 0.3s; color: #cbd5e1;">
                            <input type="radio" name="parser-mode" value="single" checked onchange="switchParserMode('single')" style="margin-right: 10px; cursor: pointer; accent-color: #3b82f6; width: 18px; height: 18px;">
                            <span style="font-weight: 600; font-size: 1rem;">Single File</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer; padding: 10px 15px; border-radius: 8px; transition: all 0.3s; color: #cbd5e1;">
                            <input type="radio" name="parser-mode" value="project" onchange="switchParserMode('project')" style="margin-right: 10px; cursor: pointer; accent-color: #3b82f6; width: 18px; height: 18px;">
                            <span style="font-weight: 600; font-size: 1rem;">Project / Folder</span>
                        </label>
                    </div>
                </div>

                <!-- Single File Mode -->
                <div id="single-file-mode">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchTab('paste')">Paste Code</button>
                        <button class="tab-btn" onclick="switchTab('upload')">Upload File</button>
                    </div>

                <div id="paste-tab" class="tab-content active">
                    <textarea id="code-input" placeholder="Paste your code here..."></textarea>
                </div>

                <div id="upload-tab" class="tab-content">
                    <div class="upload-area" id="upload-area">
                        <input type="file" id="file-input" accept=".py,.pyw,.pyi,.js,.jsx,.mjs,.java,.c,.cpp,.cc,.cxx,.h,.hpp,.hxx,.php,.phtml,.sql" style="display: none;">
                        <div class="upload-placeholder">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            <p>Click to upload or drag and drop</p>
                            <p class="upload-hint">Supported: .py, .js, .jsx, .java, .c, .cpp, .php, .sql</p>
                        </div>
                    </div>
                </div>

                    <div class="action-buttons">
                        <button class="parse-btn" onclick="parseCode()">
                            <span>Analyze Code</span>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
                                <polyline points="19 12 19 22 5 22 5 12"></polyline>
                            </svg>
                        </button>
                        <button class="doc-btn" onclick="generateDocumentation()" id="doc-btn" style="display: none;">
                            <span>Generate Documentation</span>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Project / Folder Mode -->
                <div id="project-mode" style="display: none;">
                    <div class="tabs" style="margin-bottom: 20px;">
                        <button class="tab-btn active" onclick="switchProjectTab('path')">Local Path</button>
                        <button class="tab-btn" onclick="switchProjectTab('upload')">Upload Files/Folder</button>
                        <button class="tab-btn" onclick="switchProjectTab('github')">GitHub Repo</button>
                    </div>

                    <!-- Local Path Tab -->
                    <div id="project-path-tab" class="tab-content active">
                        <div style="padding: 32px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 16px; border: 3px dashed #475569; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%); opacity: 0.5;"></div>
                            <div style="position: relative; z-index: 1;">
                                <label style="display: block; margin-bottom: 15px; font-weight: 700; color: #60a5fa; font-size: 1rem; text-transform: uppercase; letter-spacing: 1.2px;">Local Folder Path:</label>
                                <input 
                                    type="text" 
                                    id="folder-path-input" 
                                    placeholder="Enter absolute path to project folder (e.g., /Users/username/project)"
                                    style="width: 100%; padding: 16px 20px; border: 2px solid #334155; border-radius: 12px; font-size: 14px; margin-bottom: 20px; background: #0f172a; color: #e2e8f0; transition: all 0.3s; font-family: 'Fira Code', 'Courier New', monospace;"
                                    onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 4px rgba(59, 130, 246, 0.2), 0 4px 16px rgba(59, 130, 246, 0.3)'; this.style.background='#1e293b';"
                                    onblur="this.style.borderColor='#334155'; this.style.boxShadow='none'; this.style.background='#0f172a';"
                                >
                                <button class="parse-btn" onclick="parseProject()" style="width: 100%;">
                                    <span>Parse Project</span>
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
                                        <polyline points="19 12 19 22 5 22 5 12"></polyline>
                                    </svg>
                                </button>
                                <p style="margin-top: 15px; font-size: 0.9rem; color: #94a3b8; text-align: center; font-weight: 400;">
                                    Enter the absolute path to your project folder on your local machine
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Files/Folder Tab -->
                    <div id="project-upload-tab" class="tab-content">
                        <div style="padding: 32px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 16px; border: 3px dashed #475569; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%); opacity: 0.5;"></div>
                            <div style="position: relative; z-index: 1;">
                                <div class="upload-area" id="project-upload-area" style="min-height: 200px;">
                                    <input type="file" id="project-file-input" multiple style="display: none;">
                                    <div class="upload-placeholder" style="text-align: center; padding: 40px 20px;">
                                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 auto 20px; color: #60a5fa;">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="17 8 12 3 7 8"></polyline>
                                            <line x1="12" y1="3" x2="12" y2="15"></line>
                                        </svg>
                                        <p style="font-size: 1.1rem; color: #e2e8f0; margin-bottom: 10px; font-weight: 600;">Upload Project Files or Folder</p>
                                        <p style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 20px;">Click to browse or drag and drop files/folders</p>
                                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                                            <button onclick="document.getElementById('project-file-input').click()" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
                                                Select Files
                                            </button>
                                            <button onclick="enableFolderUpload()" style="padding: 10px 20px; background: #475569; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='#334155'" onmouseout="this.style.background='#475569'">
                                                Select Folder
                                            </button>
                                        </div>
                                        <p class="upload-hint" style="margin-top: 15px; font-size: 0.85rem; color: #64748b;">Supported: .py, .js, .jsx, .java, .c, .cpp, .php, .sql</p>
                                    </div>
                                    <div id="project-file-list" style="display: none; margin-top: 20px; padding: 20px; background: rgba(15, 23, 42, 0.5); border-radius: 8px; max-height: 300px; overflow-y: auto;">
                                        <h4 style="color: #60a5fa; margin-bottom: 15px;">Selected Files:</h4>
                                        <div id="project-file-list-content"></div>
                                        <button class="parse-btn" onclick="parseUploadedProject()" style="width: 100%; margin-top: 20px;">
                                            <span>Parse Uploaded Files</span>
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="5 12 3 12 12 3 21 12 19 12"></polyline>
                                                <polyline points="19 12 19 22 5 22 5 12"></polyline>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GitHub Repository Tab -->
                    <div id="project-github-tab" class="tab-content">
                        <div style="padding: 32px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 16px; border: 3px dashed #475569; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%); opacity: 0.5;"></div>
                            <div style="position: relative; z-index: 1;">
                                <label style="display: block; margin-bottom: 15px; font-weight: 700; color: #60a5fa; font-size: 1rem; text-transform: uppercase; letter-spacing: 1.2px;">GitHub Repository URL:</label>
                                <input 
                                    type="text" 
                                    id="github-repo-input" 
                                    placeholder="Enter GitHub repo URL (e.g., https://github.com/username/repo)"
                                    style="width: 100%; padding: 16px 20px; border: 2px solid #334155; border-radius: 12px; font-size: 14px; margin-bottom: 20px; background: #0f172a; color: #e2e8f0; transition: all 0.3s; font-family: 'Fira Code', 'Courier New', monospace;"
                                    onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 4px rgba(59, 130, 246, 0.2), 0 4px 16px rgba(59, 130, 246, 0.3)'; this.style.background='#1e293b';"
                                    onblur="this.style.borderColor='#334155'; this.style.boxShadow='none'; this.style.background='#0f172a';"
                                    onkeypress="if(event.key === 'Enter') cloneAndParseRepo()"
                                >
                                <button class="parse-btn" onclick="cloneAndParseRepo()" style="width: 100%;">
                                    <span>Clone & Parse Repo</span>
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                                    </svg>
                                </button>
                                <p style="margin-top: 15px; font-size: 0.9rem; color: #94a3b8; text-align: center; font-weight: 400;">
                                    Enter a GitHub repository URL to clone and parse the project
                                </p>
                                <div id="github-repo-info" style="display: none; margin-top: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; border-radius: 8px;">
                                    <h4 style="color: #60a5fa; margin-bottom: 10px; font-size: 1rem;">Repository Information:</h4>
                                    <div id="github-repo-info-content" style="color: #cbd5e1; font-size: 0.9rem;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="output-section" id="output-section" style="display: none;">
                <!-- File Explorer Sidebar (only shown for projects) -->
                <div id="file-explorer-sidebar" class="file-explorer-sidebar" style="display: none;">
                    <div class="sidebar-header">
                        <h3>üìÅ Files</h3>
                        <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle Sidebar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="sidebar-content" id="file-explorer-list">
                        <!-- File list will be populated here -->
                    </div>
                </div>

                <div class="results-main-content" id="results-main-content">
                    <div class="output-header">
                        <h2>Analysis Results</h2>
                        <div class="output-actions">
                            <button id="full-project-diagrams-btn" class="action-btn" onclick="showFullProjectDiagrams()" style="display: none;">
                                <span>üìä Generate Full-Project Diagrams</span>
                            </button>
                            <button class="action-btn" onclick="toggleView()">
                                <span id="view-toggle">View JSON</span>
                            </button>
                            <button class="action-btn" onclick="copyToClipboard(event)">
                                <span>Copy JSON</span>
                            </button>
                        </div>
                    </div>

                    <div id="summary-view" class="summary-view">
                        <!-- Summary will be inserted here -->
                    </div>
                </div>

                <div id="json-view" class="json-view" style="display: none;">
                    <pre id="json-output"></pre>
                </div>
            </div>

            <div class="diagrams-section" id="diagrams-section" style="display: none;">
                <div class="diagrams-header">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                        <div>
                            <h2>Code Diagrams</h2>
                            <p class="diagrams-subtitle">Visual representation of code structure and relationships</p>
                        </div>
                        <!-- File selector dropdown (only shown for projects) -->
                        <div id="diagram-file-selector" style="display: none;">
                            <label style="display: block; margin-bottom: 8px; color: #cbd5e1; font-weight: 600; font-size: 0.9rem;">Select File:</label>
                            <select id="diagram-file-select" onchange="switchDiagramFile(event)" style="
                                padding: 10px 16px;
                                border: 2px solid #334155;
                                border-radius: 8px;
                                background: #0f172a;
                                color: #e2e8f0;
                                font-family: 'Fira Code', 'Courier New', monospace;
                                font-size: 0.9rem;
                                cursor: pointer;
                                transition: all 0.3s;
                                appearance: none;
                                min-width: 250px;
                                background-image: url('data:image/svg+xml;utf8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'12\\' height=\\'12\\' viewBox=\\'0 0 12 12\\'><path fill=\\'%2360a5fa\\' d=\\'M6 9L1 4h10z\\'/></svg>');
                                background-repeat: no-repeat;
                                background-position: right 12px center;
                                padding-right: 40px;
                            " onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 4px rgba(59, 130, 246, 0.2)'" onblur="this.style.borderColor='#334155'; this.style.boxShadow='none'">
                                <option value="">Select a file...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="diagram-tabs">
                    <button class="diagram-tab-btn active" onclick="switchDiagramTab('architecture', event)">Architecture</button>
                    <button class="diagram-tab-btn" onclick="switchDiagramTab('sequence', event)">Sequence</button>
                    <button class="diagram-tab-btn" onclick="switchDiagramTab('dependencies', event)">Dependencies</button>
                    <button class="diagram-tab-btn" onclick="switchDiagramTab('flowchart', event)">Flowchart</button>
                    <button class="diagram-tab-btn" onclick="switchDiagramTab('structure', event)">Structure</button>
                </div>

                <div id="architecture-diagram" class="diagram-content active">
                    <div class="diagram-container">
                        <div class="mermaid" id="architecture-mermaid"></div>
                    </div>
                </div>

                <div id="sequence-diagram" class="diagram-content">
                    <div class="diagram-container">
                        <div class="mermaid" id="sequence-mermaid"></div>
                    </div>
                </div>

                <div id="dependencies-diagram" class="diagram-content">
                    <div class="diagram-container">
                        <div class="mermaid" id="dependencies-mermaid"></div>
                    </div>
                </div>

                <div id="flowchart-diagram" class="diagram-content">
                    <div class="diagram-container">
                        <div class="mermaid" id="flowchart-mermaid"></div>
                    </div>
                    <div class="svg-download-section">
                        <button class="action-btn svg-download-btn" onclick="downloadSVGFlowchart()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <span>Download SVG Flowchart</span>
                        </button>
                    </div>
                </div>

                <div id="structure-diagram" class="diagram-content">
                    <div class="diagram-container">
                        <div class="mermaid" id="structure-mermaid"></div>
                    </div>
                </div>
            </div>

            <div class="documentation-section" id="documentation-section" style="display: none;">
                <div class="doc-header">
                    <h2>Generated Documentation</h2>
                    <div class="doc-tabs">
                        <button class="doc-tab-btn active" onclick="switchDocTab('docstrings', event)">Docstrings</button>
                        <button class="doc-tab-btn" onclick="switchDocTab('readme', event)">README.md</button>
                        <button class="doc-tab-btn" onclick="switchDocTab('architecture', event)">ARCHITECTURE.md</button>
                    </div>
                </div>

                <div id="docstrings-view" class="doc-content active">
                    <div class="doc-actions">
                        <button class="action-btn" onclick="downloadDoc('docstrings')">Download Code with Docstrings</button>
                        <button class="action-btn" onclick="copyDoc('docstrings', event)">Copy to Clipboard</button>
                    </div>
                    <pre id="docstrings-content" class="doc-code"></pre>
                </div>

                <div id="readme-view" class="doc-content">
                    <div class="doc-actions">
                        <button class="action-btn" onclick="downloadDoc('readme')">Download README.md</button>
                        <button class="action-btn" onclick="copyDoc('readme', event)">Copy to Clipboard</button>
                    </div>
                    <div id="readme-content" class="doc-markdown"></div>
                </div>

                <div id="architecture-view" class="doc-content">
                    <div class="doc-actions">
                        <button class="action-btn" onclick="downloadDoc('architecture')">Download ARCHITECTURE.md</button>
                        <button class="action-btn" onclick="copyDoc('architecture', event)">Copy to Clipboard</button>
                    </div>
                    <div id="architecture-content" class="doc-markdown"></div>
                </div>
            </div>

            <div id="error-message" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>

